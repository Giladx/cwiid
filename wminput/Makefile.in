#Copyright (C) 2007 L. Donnie Smith

COMMON = @top_builddir@/common
include $(COMMON)/include/defs.mak

APP_NAME = wminput

SOURCES = main.c conf.c uinput.c action_enum.c parser.c lexer.c util.c

CFLAGS += -I@top_builddir@/wiimote \
	-DWMINPUT_CONFIG_DIR=\"$(WMINPUT_CONFIG_DIR)\"
LDLIBS = -lwiimote -ldl
LDFLAGS = -L@top_builddir@/wiimote -rdynamic
INST_DIR = @bindir@
WMINPUT_CONFIG_DIR = $(CWIID_CONFIG_DIR)/wminput

YFLAGS = -d

include $(COMMON)/include/app.mak

all install clean distclean uninstall: make_plugins

install: install_configs

#DON'T UNINSTALL CONFIGS
#uninstall: uninstall_configs

make_plugins:
	$(MAKE) $(MAKECMDGOALS) -C plugins

install_configs:
	mkdir -p $(WMINPUT_CONFIG_DIR)
	cp configs/* $(WMINPUT_CONFIG_DIR)
	ln -sf $(WMINPUT_CONFIG_DIR)/acc_ptr \
		$(WMINPUT_CONFIG_DIR)/default

#uninstall_configs:
#	rm -f $(WMINPUT_CONFIG_DIR)/default
#	for c in `ls configs`; do				\
#		rm -f $(WMINPUT_CONFIG_DIR)/$$c;	\
#	done
#	rmdir $(WMINPUT_CONFIG_DIR); true

action_enum.c: action_enum.awk action_enum.txt
	./action_enum.awk action_enum.txt > action_enum.c

conf.o lexer.c: y.tab.h

y.tab.h: parser.c

clean: clean_gen

clean_gen:
	rm -f action_enum.c parser.c lexer.c y.tab.h

distclean: clean
	rm Makefile

.PHONY: all install clean distclean uninstall make_plugins clean_gen
